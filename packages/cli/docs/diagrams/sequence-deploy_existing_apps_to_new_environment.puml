@startuml
'https://plantuml.com/sequence-diagram

autonumber

' need mechanism to figure out which services need to be updated if a given global parameter is updated
title sequence diagram - deploy an existing service to a new environment
actor ServiceDeveloper

ServiceDeveloper -> github: A developer creates a new branch for the environment using the environment branch naming convention env/newEnvironmentName
cenv_ci_cd -> cenv_cli: The cenv_ci_cd github action workflow invokes determines that a new environment branch has been created that has not been configured to host applications for the new environment so it runs "cenv init -e [newEnvironmentName] -aa --defaults"
cenv_cli -> AWS_AppConfig: The cenv_cli creates the required backend infrastructure to manage each new app on the new environment
cenv_cli -> GH_repo: The cenv_cli then generates local .cenv.newBranchName and .cenv.newBranchName.config files for each application environment that is in the mono repo. Package tags, namely package.nx.tags[ec:sls] || [ec:ecs] determine which services are configured
cenv_cli -> AWS_ParameterStore: Then the cli will create an environment specific copy of\n the services environment variables to AWS Parameter Store
cenv_cli -> GH_repo: Then the cli saves an environment config to the repo ".qa.cenv.config" \nwhich the service will use as configuration when its running on \nthat environment.
cenv_cli -> AWS_AppConfig: the cli then creates an application configuration deployment so that the apps can actually retrieve a materialized environment specific configuration from AWS AppConfig

@enduml
